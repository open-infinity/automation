global
  daemon
  user haproxy
  group haproxy
  pidfile /var/run/haproxy.pid
  tune.bufsize 32768
  log 127.0.0.1 local2 debug debug


defaults
  log     global
  option  tcplog
  option  dontlognull
  option  dontlog-normal
  retries 3
  timeout connect 4000
  timeout client <%= cli_timeout %>
  timeout server <%= srv_timeout %>


frontend main_https *:3306
  mode tcp
  default_backend jdbc


backend jdbc
  balance source
  mode tcp
  option tcpka
  <% i = 1 %>
  <% backend_addresses.each do |backend_address| %>
    server server<%= i %> <%= backend_address %>:3306 check
    <% i = i +1 %>
  <% end %>
